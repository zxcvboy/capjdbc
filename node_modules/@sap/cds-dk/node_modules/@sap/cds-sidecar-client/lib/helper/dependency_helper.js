const os = require('os');
const path = require('path');
const childProcess = require('child_process');

let cachedDir;

class DependencyHelper {
    static get globalModulesDir() {
        if (cachedDir) {
            return cachedDir;
        }
        const prefix = childProcess.execFileSync('npm', ['root', '-g'], { encoding: 'utf8' }).trim();
        cachedDir = os.platform === 'win32'
            ? path.join(prefix, 'node_modules')
            : path.join(prefix, 'lib', 'node_modules');
        return cachedDir;
    }

    static requireGlobal(packageId) {
        const packagePath = require.resolve(packageId, { paths: [DependencyHelper.globalModulesDir] });
        return require(packagePath);
    }
}

module.exports = DependencyHelper;
