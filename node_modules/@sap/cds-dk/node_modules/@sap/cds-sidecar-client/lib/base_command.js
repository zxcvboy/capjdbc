const MTX_URL_PATH_PREFIX = 'mtx/v1/model/';
const CUSTOM_FILE_URL_SUFFIX = 'customTenantContent';

const path = require('path');
const fs = require('fs-extra');
const { URL } = require('url');
const clientLog = require('./helper/logging');
const urlHelper = require('./helper/url_helper');

class BaseCommand {

    static get CUSTOM_FILE_URL_SUFFIX() { return CUSTOM_FILE_URL_SUFFIX; }

    static async checkProject(folder) {
        return fs.pathExists(path.join(folder, 'package.json'));
    }

    static async handleHttpError(error, options) {
        if (error.name === 'HTTPError') {
            const statusCode = error.response.statusCode;
            switch (statusCode) {
                case 401: {
                    clientLog.error('Request failed: authorization might have expired. Please retry with valid passcode' +
                        (options.passcodeUrl ? ` from ${options.passcodeUrl}` : ''), error);
                    return;
                }
                case 404:
                    clientLog.error(`Request failed. Please check application URL ${options.appUrl}`, error);
                    return;
            }
        }

        // Errors handled here include 422 (compilation or native-extension error).
        clientLog.error(undefined, error);
    }

    static getMtxApiUrl(url, action) {
        const parsedUrl = new URL(url);
        parsedUrl.pathname = path.join(parsedUrl.pathname, MTX_URL_PATH_PREFIX, action);
        return parsedUrl.toString();
    }
}

module.exports = BaseCommand;
