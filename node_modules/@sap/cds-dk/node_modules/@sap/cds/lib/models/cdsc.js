/* eslint-disable no-console */

const cdsc = require ('@sap/cds-compiler')
module.exports = cdsc


const DEBUG = process.env.DEBUG_CDSC && console.warn
if (DEBUG) {
    _debug (cdsc.for, 'compile.for.')
    _debug (cdsc.to, 'compile.to.')
    _debug (cdsc, 'cdsc.')
}

function _debug(cdsc, _prefix = '') { //NOSONAR
    for (let [each, fn] of Object.entries(cdsc)) {
        if (typeof fn === 'function') {
            cdsc[each] = (...args) => {
                console.log('---------------------------')
                if (each === 'compile') console.trace(_prefix + each, ...args)
                else console.trace(_prefix + each, args[1])
                console.log('---------------------------')
                return fn(...args)
            }
            if (typeof fn.all === 'function') {
                cdsc[each].all = (...args) => {
                    console.log('---------------------------')
                    if (each === 'compile') console.trace(_prefix + each, ...args)
                    else console.trace(_prefix + each + ".all", args[1])
                    console.log('---------------------------')
                    return fn.all(...args)
                }
            }
        }
    }
    return cdsc
}
