const { Whereable, Query, parse } = require('./Whereable')

const classes = {
  SELECT: require('./SELECT'),
  INSERT: require('./INSERT'),
  UPDATE: require('./UPDATE'),
  DELETE: require('./DELETE'),
  CREATE: require('./CREATE'),
  DROP: require('./DROP'),
  Whereable,
  Query,
}

module.exports = {
  SELECT: classes.SELECT._,
  INSERT: classes.INSERT._,
  UPDATE: classes.UPDATE._,
  DELETE: classes.DELETE._,
  CREATE: classes.CREATE._,
  DROP: classes.DROP._,
  classes,
  parse,
}

// beautify output in REPL
const { inspect } = module.require('util')
Query.prototype[inspect.custom] = function () {
  const colors = process.env.CDS_TERM_COLORS !== false
  return inspect({ ...this }, { colors, depth: 22 })
    .replace(/^{\s*/g, '{ ')
    .replace(/{ ref: \[([^\]]*)\] }/g, (_, ref) => '{ref:[' + ref.slice(1, -1) + ']}')
    .replace(/{ val: ([^ ]*) }/g, '{val:$1}')
    .replace(/{ (xpr|ref|val): /g, '{$1:')
}
